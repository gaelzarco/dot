context.modules = [
  { name = libpipewire-module-raop-discover
    args = {
      stream.rules = [
        {
          matches = [
            { raop.hostname = "~^hpm(1|2)x(\\.local)?$" }
          ]
          actions = {
            create-stream = {
              stream.props = {
                media.class       = "Audio/Sink"
                audio.rate        = 44100
                resample.quality  = 4
                # Fix: latency must be a multiple of rtp.ptime (~7.981859 ms)
                # Pick a clean multiple; 32× ≈ 255.420
                sess.latency.msec = 255.420
                # HomePod-friendly RTP caps
                rtp.audio.rate    = 44100
                rtp.channels      = 2
              }
            }
          }
        }
      ]
    }
  }
]
